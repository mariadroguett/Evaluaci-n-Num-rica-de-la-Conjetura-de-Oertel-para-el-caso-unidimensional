Bootstrap: docker
From: python:3.9-slim

%labels
    Author maria
    Description "Entorno Singularity para Evaluación Numérica de la Conjetura de Oertel"

%environment
    export PYTHONPATH=/opt/app:${PYTHONPATH}
    export OMP_NUM_THREADS=1
    export OPENBLAS_NUM_THREADS=1
    export MKL_NUM_THREADS=1
    export NUMEXPR_MAX_THREADS=1
    export PYTHONUTF8=1
    export PYTHONIOENCODING=utf-8

%post
    set -eux
    apt-get update
    apt-get install -y --no-install-recommends build-essential python3-dev
    rm -rf /var/lib/apt/lists/*
    mkdir -p /opt/app
    python -m pip install --upgrade pip
    pip install --no-cache-dir -r /opt/app/requirements.txt

%files
    requirements.txt /opt/app/requirements.txt
    . /opt/app

%runscript
    exec python /opt/app/run_ortel_parallel.py "$@"

